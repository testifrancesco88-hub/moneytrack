<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MoneyTrack">

  <!-- Android/Chrome -->
  <meta name="theme-color" content="#111827">
  <title>MoneyTrack - Pro</title>

  <!-- ‚úÖ iOS Home Screen Icon (QUESTA √® la pi√π importante) -->
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/icon-180.png?v=3">
  <link rel="apple-touch-icon-precomposed" href="./assets/icon-180.png?v=3">

  <!-- ‚úÖ Favicons -->
  <link rel="icon" type="image/png" sizes="192x192" href="./assets/icon-192.png?v=3">
  <link rel="icon" type="image/png" sizes="512x512" href="./assets/icon-512.png?v=3">

  <!-- ‚úÖ Manifest reale -->
  <link rel="manifest" href="./manifest.webmanifest?v=3">

  <style>
    :root{
      --primary:#2563eb;
      --success:#16a34a;
      --danger:#dc2626;
      --dark:#111827;
      --gray-bg:#f3f4f6;
      --slate:#374151;
      --purple:#7c3aed;
      --cyan:#0ea5e9;
    }

    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:var(--dark);
      overflow:hidden;
      position:fixed;
      width:100%;
      height:100%;
      overscroll-behavior:none;
    }
    #app{width:100%;height:100%;display:flex;flex-direction:column;background:white;}

    /* ‚úÖ Splash overlay */
    #splash{
      position:fixed; inset:0;
      background:linear-gradient(180deg, #0b1220, #111827);
      display:flex; align-items:center; justify-content:center;
      z-index:9999;
      transition:opacity .35s ease, transform .35s ease;
    }
    #splash.hidden{
      opacity:0;
      transform:scale(1.02);
      pointer-events:none;
    }
    .splash-card{display:flex;flex-direction:column;align-items:center;gap:14px;}
    .splash-logo{
      width:92px;height:92px;border-radius:24px;
      background:rgba(255,255,255,0.10);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    .splash-logo img{
      width:100%;height:100%;
      object-fit:cover;
      display:block;
    }
    .splash-title{
      font-weight:900;font-size:22px;
      background:linear-gradient(135deg,#06b6d4,#3b82f6);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      letter-spacing:.2px;
    }
    .splash-sub{
      color:rgba(255,255,255,.55);
      font-size:12px;font-weight:800;
      letter-spacing:1px;text-transform:uppercase;
    }

    .header{
      background:var(--dark);
      color:white;
      padding:env(safe-area-inset-top) 16px 14px 16px;
      display:flex;align-items:center;justify-content:space-between;
      z-index:10;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .header-green{background:var(--success);}
    .header-blue{background:var(--primary);}
    .header-gray{background:var(--slate);}

    .content{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;background:white;}

    /* ‚úÖ Header app-style iOS */
    .header-left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:120px;
    }
    .header-logo{
      width:26px;height:26px;border-radius:8px;
      background:rgba(255,255,255,0.10);
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
    }
    .header-logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .header-title{
      font-weight:900;
      font-size:14px;
      letter-spacing:.2px;
    }

    .logo-container{text-align:center;padding:26px 20px;background:var(--dark);}

    /* ‚úÖ Riquadro logo home: ADATTATO (NO aria eccessiva) */
    .logo-icon{
      width:104px;height:104px;margin:0 auto 12px;
      border-radius:26px;
      background:rgba(255,255,255,0.10);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      box-shadow:0 10px 25px rgba(0,0,0,0.25);
    }

    /* ‚úÖ Il segreto √® qui:
       - cover: riempie il riquadro
       - scale: micro-zoom per non ‚Äúrespirare‚Äù troppo e rimanere leggibile */
    .logo-img{
      width:100%;
      height:100%;
      object-fit:cover;
      transform:scale(1.06);
      display:block;
    }

    .logo-text{
      font-size:24px;font-weight:900;
      background:linear-gradient(135deg,#06b6d4,#3b82f6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }

    .list-item{
      padding:18px 20px;
      border-bottom:1px solid #f0f0f0;
      display:flex;align-items:center;justify-content:space-between;
      transition:background 0.1s;
      cursor:pointer;
    }
    .list-item:active{background:#f9fafb;}

    .btn{
      padding:14px;border:none;border-radius:12px;
      font-size:15px;font-weight:800;cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      transition:transform 0.1s, opacity 0.2s;
      user-select:none;
    }
    .btn:active{transform:scale(0.96);}
    .btn-primary{background:var(--success);color:white;}
    .btn-danger{background:var(--danger);color:white;}
    .btn-outline{background:#e5e7eb;color:#374151;}
    .btn:disabled{opacity:0.4;cursor:not-allowed;transform:none!important;}

    .display-box{padding:15px;text-align:center;position:relative;}
    .display-label{font-size:11px;text-transform:uppercase;letter-spacing:1px;opacity:0.8;margin-bottom:4px;}
    .display-value{font-size:32px;font-weight:900;font-variant-numeric:tabular-nums;}

    .keypad{
      display:grid;grid-template-columns:repeat(3,1fr);
      gap:10px;padding:15px;background:#f9fafb;
    }
    .key{
      height:60px;border:none;border-radius:14px;
      font-size:22px;font-weight:900;background:white;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);
      color:var(--dark);
      cursor:pointer;
      transition:transform .1s, background .1s, opacity .2s;
      user-select:none;
    }
    .key:active{background:#e2e8f0;transform:scale(0.95);}
    .key.action{background:#fee2e2;color:var(--danger);}

    .info-card{
      margin:20px;padding:26px 20px;
      background:var(--dark);color:white;
      border-radius:20px;text-align:center;
      box-shadow:0 10px 25px rgba(0,0,0,0.2);
    }
    .dev-badge{
      display:inline-block;padding:6px 15px;
      background:rgba(255,255,255,0.1);border-radius:30px;
      font-size:12px;font-weight:900;color:#06b6d4;margin-bottom:15px;
    }

    @media (max-height: 720px){
      .logo-container{padding:18px 15px;}
      .logo-icon{width:92px;height:92px;border-radius:22px;}
      .keypad{gap:8px;padding:12px;}
      .key{height:50px;font-size:20px;border-radius:12px;}
      .btn{padding:12px;font-size:14px;}
      .display-box{padding:12px;}
      .display-value{font-size:26px;}
      .header{padding-bottom:12px;}
    }
    @media (max-height: 640px){
      .logo-icon{width:86px;height:86px;border-radius:20px;}
      .key{height:44px;font-size:18px;}
      .display-value{font-size:24px;}
      .btn{padding:10px;font-size:13px;}
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Splash Screen -->
  <div id="splash">
    <div class="splash-card">
      <div class="splash-logo">
        <img src="./assets/icon-512.png?v=3" alt="MoneyTrack">
      </div>
      <div class="splash-title">MoneyTrack</div>
      <div class="splash-sub">Loading‚Ä¶</div>
    </div>
  </div>

  <div id="app"></div>

  <script>
    // ‚úÖ Icona ‚Äúpulita‚Äù dentro l‚Äôapp
    const LOGO_SRC = "./assets/icon-512.png?v=3";

    const banks = ['Euronet','Chianti Banca','CCB','CRV','Medio Banca','MPS','MPS PG','Intesa S.Paolo'];
    const employees = ['Francesco','Silvia','Dorota','William','Stefania','Filomena','Valeria','Flavio','Ciro','Alessandro','Ida'];

    const STORAGE_KEY = "moneytrack_pro_v2";

    let state = {
      screen: 'banks',
      selectedBank: '',
      selectedEmployee: '',
      amount: '0',
      totals: {}
    };

    function getKey(bank, emp){ return `${bank}|||${emp}`; }

    function formatEUR(n){
      return new Intl.NumberFormat('it-IT', { style:'currency', currency:'EUR' }).format(Number(n)||0);
    }

    function safeParse(v){
      const s = (v ?? "0").toString();
      if (s === "." || s === "") return 0;
      if (s.endsWith(".")) return parseFloat(s.slice(0,-1)) || 0;
      const val = parseFloat(s);
      return isNaN(val) ? 0 : val;
    }

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ totals: state.totals }));
    }

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return;
        const parsed = JSON.parse(raw);
        state.totals = parsed.totals || {};
      }catch(e){
        state.totals = {};
      }
    }

    function addDigit(d){
      let cur = state.amount;
      if(cur === '0') state.amount = d;
      else if(cur.length < 10) state.amount = cur + d;
      render();
    }
    function addDecimal(){
      if(!state.amount.includes('.')) state.amount += '.';
      render();
    }
    function deleteDigit(){
      state.amount = (state.amount.length > 1) ? state.amount.slice(0,-1) : '0';
      render();
    }

    function headerHTML(rightButtons, backHTML=''){
      return `
        <div class="header">
          <div class="header-left">
            ${backHTML}
            <div class="header-logo"><img src="${LOGO_SRC}" alt="MT"></div>
            <div class="header-title">MoneyTrack Pro</div>
          </div>
          <div style="display:flex; gap:10px">${rightButtons||''}</div>
        </div>
      `;
    }

    function render(){
      const app = document.getElementById('app');

      if(state.screen === 'banks'){
        app.innerHTML = `
          ${headerHTML(`
            <button class="btn" style="background:#374151; padding:8px; width:40px" onclick="alert('Stats: in arrivo üòÑ')">üìä</button>
            <button class="btn" style="background:#374151; padding:8px; width:40px" onclick="state.screen='info'; render()">‚ÑπÔ∏è</button>
          `)}

          <div class="logo-container">
            <div class="logo-icon">
              <img class="logo-img" src="${LOGO_SRC}" alt="MoneyTrack logo">
            </div>
            <div class="logo-text">MoneyTrack</div>
          </div>

          <div class="header header-green" style="padding:10px 16px; font-size:13px">
            SELEZIONA BANCA
          </div>

          <div class="content">
            ${banks.map(b => `
              <div class="list-item" onclick="state.selectedBank='${b}'; state.screen='employees'; render()">
                <span style="font-weight:900">${b}</span>
                <span style="color:#9ca3af">‚Ä∫</span>
              </div>
            `).join('')}
          </div>
        `;
        return;
      }

      if(state.screen === 'info'){
        app.innerHTML = `
          ${headerHTML('', `<button class="btn" style="background:transparent; color:white; font-size:20px" onclick="state.screen='banks'; render()">‚Äπ</button>`)}
          <div class="content" style="background:var(--gray-bg)">
            <div class="info-card">
              <div class="logo-icon" style="margin:0 auto 18px;">
                <img class="logo-img" src="${LOGO_SRC}" alt="MoneyTrack logo">
              </div>

              <div class="dev-badge">DEVELOPER</div>
              <h1 style="font-size:28px; letter-spacing:1px; margin-bottom:5px">TESTI FRANCESCO</h1>
              <p style="opacity:0.6; font-size:14px">Software Engineer & Design</p>

              <div style="margin-top:26px; padding-top:18px; border-top:1px solid rgba(255,255,255,0.1); font-size:12px; opacity:0.4">
                MoneyTrack Pro v1.3.2<br>¬© 2024 Tutti i diritti riservati
              </div>
            </div>
          </div>
        `;
        return;
      }

      if(state.screen === 'employees'){
        app.innerHTML = `
          <div class="header header-blue">
            <div class="header-left">
              <button class="btn" style="background:transparent; color:white; font-size:20px" onclick="state.screen='banks'; render()">‚Äπ</button>
              <div class="header-logo"><img src="${LOGO_SRC}" alt="MT"></div>
              <div class="header-title">${state.selectedBank}</div>
            </div>
            <div style="width:40px"></div>
          </div>

          <div class="content">
            ${employees.map(e => {
              const total = state.totals[getKey(state.selectedBank, e)] || 0;
              return `
                <div class="list-item" onclick="state.selectedEmployee='${e}'; state.screen='counter'; state.amount='0'; render()">
                  <span style="font-weight:800">${e}</span>
                  <span style="font-weight:900; color:var(--success)">${formatEUR(total)}</span>
                </div>
              `;
            }).join('')}
          </div>
        `;
        return;
      }

      if(state.screen === 'counter'){
        const key = getKey(state.selectedBank, state.selectedEmployee);
        const total = state.totals[key] || 0;

        app.innerHTML = `
          <div class="header header-gray">
            <div class="header-left">
              <button class="btn" style="background:transparent; color:white; font-size:20px" onclick="state.screen='employees'; render()">‚Äπ</button>
              <div class="header-logo"><img src="${LOGO_SRC}" alt="MT"></div>
              <div class="header-title">${state.selectedEmployee}</div>
            </div>
            <div style="width:40px"></div>
          </div>

          <div class="content">
            <div class="display-box" style="background:var(--primary); color:white">
              <div class="display-label">Tot. dipendente</div>
              <div class="display-value">${formatEUR(total)}</div>
            </div>

            <div class="display-box" style="background:#f9fafb">
              <div class="display-label" style="color:#6b7280">Inserimento</div>
              <div class="display-value" style="color:var(--dark)">‚Ç¨ ${state.amount}</div>
            </div>

            <div class="keypad">
              ${[1,2,3,4,5,6,7,8,9].map(n => `<button class="key" onclick="addDigit('${n}')">${n}</button>`).join('')}
              <button class="key" onclick="addDecimal()">.</button>
              <button class="key" onclick="addDigit('0')">0</button>
              <button class="key action" onclick="deleteDigit()">‚å´</button>
            </div>

            <div style="padding:15px">
              <button class="btn btn-primary" style="width:100%" onclick="
                const k='${key}';
                state.totals[k]=(state.totals[k]||0)+safeParse(state.amount);
                state.amount='0';
                save();
                render();
              ">CONFERMA E AGGIUNGI</button>
            </div>
          </div>
        `;
        return;
      }
    }

    load();
    render();

    // ‚úÖ Splash: 2 secondi poi fade out
    window.addEventListener('load', () => {
      const splash = document.getElementById('splash');
      setTimeout(() => {
        splash.classList.add('hidden');
        setTimeout(() => splash.remove(), 450);
      }, 2000);
    });

    // Previene lo zoom su double tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event){
      const now = Date.now();
      if(now - lastTouchEnd <= 300) event.preventDefault();
      lastTouchEnd = now;
    }, false);
  </script>
</body>
</html>
