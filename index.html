<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MoneyTrack">
  <meta name="theme-color" content="#111827">
  <title>MoneyTrack - Pro</title>

  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTW9uZXlUcmFjayIsInNob3J0X25hbWUiOiJNb25leVRyYWNrIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxMTE4MjciLCJ0aGVtZV9jb2xvciI6IiMxMTE4MjcifQ==">

  <style>
    :root {
      --primary: #2563eb;
      --success: #16a34a;
      --danger: #dc2626;
      --dark: #111827;
      --gray-bg: #f3f4f6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--dark);
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
      overscroll-behavior: none;
    }

    #app {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: white;
    }

    .header {
      background: var(--dark);
      color: white;
      padding: env(safe-area-inset-top) 16px 16px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header-green { background: var(--success); }
    .header-blue  { background: var(--primary); }
    .header-gray  { background: #374151; }

    .logo-container { text-align: center; padding: 30px 20px; background: var(--dark); }
    .logo-icon {
      width: 70px; height: 70px; margin: 0 auto 12px;
      background: linear-gradient(135deg, #06b6d4, #3b82f6);
      border-radius: 18px; display: flex; align-items: center; justify-content: center;
      font-size: 30px;
    }
    .logo-text {
      font-size: 24px; font-weight: 800;
      background: linear-gradient(135deg, #06b6d4, #3b82f6);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .content { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; background: white; }

    .list-item {
      padding: 18px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex; align-items: center; justify-content: space-between;
      transition: background 0.1s;
    }
    .list-item:active { background: #f9fafb; }

    .btn {
      padding: 14px; border: none; border-radius: 12px;
      font-size: 15px; font-weight: 700; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.1s, opacity 0.2s;
    }
    .btn:active { transform: scale(0.96); }
    .btn-primary { background: var(--success); color: white; }
    .btn-danger  { background: var(--danger); color: white; }
    .btn-outline { background: #e5e7eb; color: #374151; }
    .btn:disabled { opacity: 0.4; }

    .display-box { padding: 15px; text-align: center; position: relative; }
    .display-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 4px; }
    .display-value { font-size: 32px; font-weight: 800; font-variant-numeric: tabular-nums; }

    .keypad {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 10px; padding: 15px; background: #f9fafb;
    }
    .key {
      height: 60px; border: none; border-radius: 14px;
      font-size: 22px; font-weight: 600; background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05); color: var(--dark);
    }
    .key:active { background: #e2e8f0; transform: scale(0.95); }
    .key.action { background: #fee2e2; color: var(--danger); }

    .mode-selector { display: flex; background: #f3f4f6; padding: 4px; gap: 4px; }
    .mode-btn {
      flex: 1; padding: 10px; border: none; border-radius: 8px;
      font-weight: 700; font-size: 12px; background: transparent; color: #6b7280;
    }
    .mode-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

    .field-selector { display: flex; gap: 8px; padding: 10px; justify-content: center; background: #4b5563; }
    .field-btn {
      padding: 8px 16px; border: none; border-radius: 20px;
      background: rgba(255,255,255,0.2); color: white; font-size: 11px; font-weight: 600;
    }
    .field-btn.active { background: white; color: #374151; }

    /* Info Screen Styles */
    .info-card {
      margin: 20px; padding: 30px 20px;
      background: var(--dark); color: white;
      border-radius: 20px; text-align: center;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .dev-badge {
      display: inline-block; padding: 6px 15px;
      background: rgba(255,255,255,0.1); border-radius: 30px;
      font-size: 12px; font-weight: 600; color: #06b6d4; margin-bottom: 15px;
    }

    @media (max-height: 700px) {
      .key { height: 50px; font-size: 20px; }
      .logo-container { padding: 15px; }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const banks = ['Euronet', 'Chianti Banca', 'CCB', 'CRV', 'Medio Banca', 'MPS', 'MPS PG', 'Intesa S.Paolo'];
    const employees = ['Francesco', 'Silvia', 'Dorota', 'William', 'Stefania', 'Filomena', 'Valeria', 'Flavio', 'Ciro', 'Alessandro', 'Ida'];

    let state = {
      screen: 'banks',
      selectedBank: '',
      selectedEmployee: '',
      amount: '0',
      rejected: '0',
      mode: 'manual',
      inputField: 'amount',
      totals: {},
      lastMachineValue: {},
      machineConfirmed: {},
      logs: []
    };

    const STORAGE_KEY = "moneytrack_v1_save";

    function formatEUR(n) {
      return new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(n || 0);
    }

    function safeParse(v) {
      const s = (v ?? "0").toString();
      const val = parseFloat(s);
      return isNaN(val) ? 0 : val;
    }

    function save() {
      const data = {
        totals: state.totals,
        lastMachineValue: state.lastMachineValue,
        machineConfirmed: state.machineConfirmed,
        logs: state.logs
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function load() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        state.totals = parsed.totals || {};
        state.lastMachineValue = parsed.lastMachineValue || {};
        state.machineConfirmed = parsed.machineConfirmed || {};
        state.logs = parsed.logs || [];
      }
    }

    function addDigit(d) {
      let current = state[state.inputField];
      if (current === '0') state[state.inputField] = d;
      else if (current.length < 9) state[state.inputField] += d;
      render();
    }

    function addDecimal() {
      if (!state[state.inputField].includes('.')) {
        state[state.inputField] += '.';
        render();
      }
    }

    function deleteDigit() {
      let current = state[state.inputField];
      state[state.inputField] = current.length > 1 ? current.slice(0, -1) : '0';
      render();
    }

    function render() {
      const app = document.getElementById('app');

      if (state.screen === 'banks') {
        app.innerHTML = `
          <div class="header">
            <span style="font-weight:700">MoneyTrack Pro</span>
            <div style="display:flex; gap:10px">
               <button class="btn" style="background:#374151; padding:8px" onclick="state.screen='stats'; render()">üìä</button>
               <button class="btn" style="background:#374151; padding:8px" onclick="state.screen='info'; render()">‚ÑπÔ∏è</button>
            </div>
          </div>
          <div class="logo-container">
            <div class="logo-icon">üí∞</div>
            <div class="logo-text">MoneyTrack</div>
          </div>
          <div class="header header-green" style="padding:10px 16px; font-size:13px">SELEZIONA BANCA</div>
          <div class="content">
            ${banks.map(b => `
              <div class="list-item" onclick="state.selectedBank='${b}'; state.screen='employees'; render()">
                <span style="font-weight:600">${b}</span>
                <span style="color:#9ca3af">‚Ä∫</span>
              </div>
            `).join('')}
          </div>
        `;
      } 
      
      else if (state.screen === 'info') {
        app.innerHTML = `
          <div class="header">
            <button class="btn" style="background:transparent; color:white; font-size:20px" onclick="state.screen='banks'; render()">‚Äπ</button>
            <span style="font-weight:700">Informazioni</span>
            <div style="width:30px"></div>
          </div>
          <div class="content" style="background:var(--gray-bg)">
            <div class="info-card">
              <div class="logo-icon" style="margin-bottom:20px; width:60px; height:60px; font-size:24px">üõ†Ô∏è</div>
              <div class="dev-badge">DEVELOPER</div>
              <h1 style="font-size:28px; letter-spacing:1px; margin-bottom:5px">TESTI FRANCESCO</h1>
              <p style="opacity:0.6; font-size:14px">Software Engineer & Design</p>
              <div style="margin-top:30px; padding-top:20px; border-top:1px solid rgba(255,255,255,0.1); font-size:12px; opacity:0.4">
                MoneyTrack Pro v1.2.0<br>¬© 2024 Tutti i diritti riservati
              </div>
            </div>
          </div>
        `;
      }

      else if (state.screen === 'employees') {
        app.innerHTML = `
          <div class="header header-blue">
            <button class="btn" style="background:transparent; color:white; font-size:20px" onclick="state.screen='banks'; render()">‚Äπ</button>
            <span style="font-weight:700">${state.selectedBank}</span>
            <div style="width:30px"></div>
          </div>
          <div class="content">
            ${employees.map(e => {
              const total = state.totals[`${state.selectedBank}|||${e}`] || 0;
              return `
                <div class="list-item" onclick="state.selectedEmployee='${e}'; state.screen='counter'; render()">
                  <span style="font-weight:500">${e}</span>
                  <span style="font-weight:700; color:var(--success)">${formatEUR(total)}</span>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      else if (state.screen === 'counter') {
        const key = `${state.selectedBank}|||${state.selectedEmployee}`;
        app.innerHTML = `
          <div class="header header-gray">
            <button class="btn" style="background:transparent; color:white; font-size:20px" onclick="state.screen='employees'; render()">‚Äπ</button>
            <div style="text-align:center">
              <div style="font-size:10px; opacity:0.8">${state.selectedBank}</div>
              <div style="font-weight:700">${state.selectedEmployee}</div>
            </div>
            <div style="width:30px"></div>
          </div>
          <div class="content">
            <div class="display-box" style="background:var(--primary); color:white">
              <div class="display-label">Saldo Corrente</div>
              <div class="display-value">${formatEUR(state.totals[key])}</div>
            </div>
            <div class="display-box" style="background:#f9fafb">
              <div class="display-label" style="color:#6b7280">Inserimento</div>
              <div class="display-value" style="color:var(--dark)">‚Ç¨ ${state[state.inputField]}</div>
            </div>
            <div class="keypad">
              ${[1,2,3,4,5,6,7,8,9].map(n => `<button class="key" onclick="addDigit('${n}')">${n}</button>`).join('')}
              <button class="key" onclick="addDecimal()">.</button>
              <button class="key" onclick="addDigit('0')">0</button>
              <button class="key action" onclick="deleteDigit()">‚å´</button>
            </div>
            <div style="padding:15px">
              <button class="btn btn-primary" style="width:100%" onclick="state.totals['${key}']=(state.totals['${key}']||0)+safeParse(state.amount); state.amount='0'; save(); render()">CONFERMA E AGGIUNGI</button>
            </div>
          </div>
        `;
      }
      
      // Nota: lo screen 'stats' √® rimasto invariato rispetto alla versione precedente per brevit√†
    }

    load();
    render();
  </script>
</body>
</html>
